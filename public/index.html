<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>BookBridge</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #e6e9ec;
      margin: 0;
      padding: 0;
    }

    .container {
      max-width: 400px;
      margin: 80px auto;
      background: #fff;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.15);
    }

    h2 {
      text-align: center;
      margin-bottom: 20px;
      color: #0b4f6c;
    }

    input, select, button {
      width: 100%;
      padding: 10px;
      margin-bottom: 12px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    button {
      background: #0b4f6c;
      color: #fff;
      border: none;
      cursor: pointer;
    }

    button:hover {
      background: #093e55;
    }

    .link {
      background: #145da0;
    }

    .hidden {
      display: none;
    }

    .msg {
      text-align: center;
      margin-top: 10px;
      font-weight: bold;
    }
  </style>
</head>

<body>

<!-- ================= LOGIN ================= -->
<div class="container" id="loginBox">
  <h2>üîê Login</h2>

  <input id="loginEmail" type="email" placeholder="Email">
  <input id="loginPass" type="password" placeholder="Password">

  <button onclick="login()">Login</button>
  <button class="link" onclick="showSignup()">Create Account</button>

  <div class="msg" id="loginMsg"></div>
</div>

<!-- ================= SIGNUP ================= -->
<div class="container hidden" id="signupBox">
  <h2>üîë Create Account</h2>

  <input id="suName" placeholder="Username">
  <input id="suEmail" type="email" placeholder="Email">
  <input id="suPass" type="password" placeholder="Password">

  <button onclick="signup()">Sign Up</button>
  <button class="link" onclick="showLogin()">Back to Login</button>

  <div class="msg" id="signupMsg"></div>
</div>

<!-- ================= UPLOAD ================= -->
<div class="container hidden" id="uploadBox">
  <h2>üìò Upload Book</h2>

  <input id="branch" placeholder="Branch">
  <input id="sem" placeholder="Semester">
  <input id="subject" placeholder="Subject">
  <input id="type" placeholder="Type (Notes / Textbook)">
  <input id="email" placeholder="Your Email">
  <input id="phone" placeholder="Phone">
  <input id="author" placeholder="Author">

  <label>Front Page:</label>
  <input id="frontFile" type="file">

  <label>TOC (optional):</label>
  <input id="tocFile" type="file">

  <button onclick="upload()">Upload</button>

  <div class="msg" id="uploadMsg"></div>
</div>

<script>
/* ================= VIEW SWITCH ================= */
function showSignup() {
  loginBox.classList.add("hidden");
  signupBox.classList.remove("hidden");
}

function showLogin() {
  signupBox.classList.add("hidden");
  loginBox.classList.remove("hidden");
}

function showUpload() {
  loginBox.classList.add("hidden");
  signupBox.classList.add("hidden");
  uploadBox.classList.remove("hidden");
}

/* ================= SIGNUP ================= */
async function signup() {
  const username = suName.value.trim();
  const email = suEmail.value.trim();
  const password = suPass.value.trim();

  if (!username || !email || !password) {
    signupMsg.innerText = "‚ùå All fields required";
    return;
  }

  try {
    const res = await fetch("/signup", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username, email, password })
    });

    const data = await res.json();
    signupMsg.innerText = data.message;

    if (data.success) {
      setTimeout(showLogin, 1200);
    }
  } catch (err) {
    signupMsg.innerText = "‚ùå Server error";
  }
}

/* ================= LOGIN ================= */
async function login() {
  const email = loginEmail.value.trim();
  const password = loginPass.value.trim();

  if (!email || !password) {
    loginMsg.innerText = "‚ùå Missing fields";
    return;
  }

  try {
    const res = await fetch("/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, password })
    });

    const data = await res.json();
    loginMsg.innerText = data.message || "";

    if (data.success) {
      showUpload();
    }
  } catch (err) {
    loginMsg.innerText = "‚ùå Server error";
  }
}

/* ================= UPLOAD ================= */
async function upload() {
  const formData = new FormData();

  formData.append("branch", branch.value);
  formData.append("sem", sem.value);
  formData.append("subject", subject.value);
  formData.append("type", type.value);
  formData.append("email", email.value);
  formData.append("phone", phone.value);
  formData.append("author", author.value);
  formData.append("frontFile", frontFile.files[0]);
  if (tocFile.files[0]) formData.append("tocFile", tocFile.files[0]);

  try {
    const res = await fetch("/api/uploads", {
      method: "POST",
      body: formData
    });

    const data = await res.json();
    uploadMsg.innerText = data.message;
  } catch (err) {
    uploadMsg.innerText = "‚ùå Upload failed";
  }
}
</script>

</body>
</html>
